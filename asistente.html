<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asistente Virtual</title>
<style>
body { font-family: Arial, sans-serif; }

/* BotÃ³n flotante */
#chatIcon {
    position: fixed; bottom: 20px; right: 20px;
    border-radius: 50%; width: 60px; height: 60px;
    background: #007bff; color: white; font-size: 30px;
    border: none; cursor: pointer; z-index: 1000;
}

/* Contenedor del chat */
#chatContainer {
    display: none; position: fixed; bottom: 90px; right: 20px;
    width: 350px; max-height: 500px; background: white;
    border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    flex-direction: column; overflow: hidden; z-index: 999;
}

#chatBox { flex: 1; padding: 15px; overflow-y: auto; }

.message { margin:10px 0; padding:10px; border-radius:8px; white-space: pre-line; }
.bot { background:#e1f0ff; align-self:flex-start; }
.user { background:#d1ffd1; align-self:flex-end; }

#userInput { display:flex; border-top:1px solid #ccc; }
#inputField { flex:1; padding:10px; border:none; }
#sendBtn { padding:10px 20px; background:#007bff; color:white; border:none; cursor:pointer; }
#sendBtn:hover { background:#0056b3; }

.opcionBtn {
    margin:5px 0; padding:8px 10px; background:#007bff;
    color:white; border:none; border-radius:6px; cursor:pointer; width:100%; text-align:left;
}
.opcionBtn:hover { background:#0056b3; }
</style>
</head>
<body>

<button id="chatIcon">ðŸ’¬</button>

<div id="chatContainer">
    <div id="chatBox"></div>
    <div id="userInput">
        <input type="text" id="inputField" placeholder="EscribÃ­ tu mensaje...">
        <button id="sendBtn">Enviar</button>
    </div>
</div>

<script>
// Normalizar texto (minÃºsculas + quitar acentos)
function normalizar(texto){
    return texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();
}

// Ãrbol completo de conversaciÃ³n
const chatTree = {
    "Inicio": {
        mensaje:"Â¡Hola! Bienvenido al soporte. Â¿CÃ³mo podemos ayudarte hoy?",
        opciones:[
            {texto:"Problemas con el sistema", nodo:"Problemas_sistema", numero:"1"},
            {texto:"Consultas sobre servicios", nodo:"Consultas_servicios", numero:"2"},
            {texto:"Promociones", nodo:"Promociones", numero:"3"},
            {texto:"Con un operador", nodo:"Operador", numero:"4"}
        ]
    },
    "Problemas_sistema": {
        mensaje:"Vamos a intentar solucionar el problema con el sistema. Â¿Se carga la pÃ¡gina correctamente?",
        opciones:[
            {texto:"SÃ­", nodo:"Problemas_si", numero:"1"},
            {texto:"No", nodo:"Problemas_no", numero:"2"}
        ]
    },
    "Problemas_si": {
        mensaje:"Â¿TenÃ©s alguna duda o consulta mÃ¡s en quÃ© te pueda ayudar?",
        opciones:[
            {texto:"SÃ­", nodo:"Inicio", numero:"1"},
            {texto:"No", nodo:"Encuesta", numero:"2"}
        ]
    },
    "Problemas_no": {
        mensaje:"Verifiquemos la conexiÃ³n. Â¿FuncionÃ³ la verificaciÃ³n de internet?",
        opciones:[
            {texto:"SÃ­", nodo:"Inicio", numero:"1"},
            {texto:"No", nodo:"Problemas_navegador", numero:"2"}
        ]
    },
    "Problemas_navegador": {
        mensaje:"Intenta abrir el sistema en otro navegador. Â¿FuncionÃ³?",
        opciones:[
            {texto:"SÃ­", nodo:"Inicio", numero:"1"},
            {texto:"No", nodo:"Operador", numero:"2"}
        ]
    },
    "Consultas_servicios": {
        mensaje:"Â¿QuÃ© consulta deseas realizar?",
        opciones:[
            {texto:"Realizar bÃºsqueda de un servicio", nodo:"Inicio", numero:"1"},
            {texto:"Procesar pago", nodo:"Inicio", numero:"2"},
            {texto:"Servicios disponibles por rubro", nodo:"Inicio", numero:"3"}
        ]
    },
    "Promociones": {
        mensaje:"Selecciona el tipo de promociÃ³n que deseas consultar:",
        opciones:[
            {texto:"Promociones vigentes", nodo:"Inicio", numero:"1"},
            {texto:"CÃ³mo participar en promociones", nodo:"Inicio", numero:"2"}
        ]
    },
    "Operador": {
        mensaje:"Te voy a derivar a un operador. Por favor, espera un momento."
    },
    "Encuesta": {
        mensaje:"Por favor, califica tu experiencia del 1 al 5, donde 1 es muy insatisfecho y 5 muy satisfecho.",
        reinicio:true
    }
};

// SinÃ³nimos y reconocimiento de palabras
const sinonimos = {
    "Problemas_sistema":["sistema","problema","error","fallo","issue","1"],
    "Consultas_servicios":["servicio","pago","abonar","consulta","2"],
    "Promociones":["promocion","oferta","premio","sorteo","3"],
    "Operador":["operador","agente","humano","persona","4"]
};

let nodoActual = "Inicio";

const chatBox = document.getElementById("chatBox");
const inputField = document.getElementById("inputField");
const sendBtn = document.getElementById("sendBtn");
const chatIcon = document.getElementById("chatIcon");
const chatContainer = document.getElementById("chatContainer");

// Mostrar mensaje
function mostrarMensaje(texto, clase="bot"){
    const div=document.createElement("div");
    div.className=`message ${clase}`;
    div.textContent=texto;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Mostrar opciones
function mostrarOpciones(opciones){
    opciones.forEach(opcion=>{
        const btn=document.createElement("button");
        btn.textContent=opcion.numero+") "+opcion.texto;
        btn.className="opcionBtn";
        btn.onclick=()=>avanzarNodo(opcion.nodo);
        chatBox.appendChild(btn);
    });
}

// Avanzar nodo
function avanzarNodo(nodo){
    nodoActual=nodo;
    mostrarMensaje(chatTree[nodo].mensaje,"bot");
    document.querySelectorAll(".opcionBtn").forEach(b=>b.remove());
    if(chatTree[nodo].opciones) mostrarOpciones(chatTree[nodo].opciones);
    if(chatTree[nodo].reinicio) setTimeout(reiniciarChat,2500);
}

// Reiniciar chat
function reiniciarChat(){
    nodoActual="Inicio";
    chatBox.innerHTML="";
    mostrarMensaje(chatTree[nodoActual].mensaje,"bot");
    mostrarOpciones(chatTree[nodoActual].opciones);
}

// Procesar mensaje del usuario
function procesarMensaje(texto){
    mostrarMensaje(texto,"user");
    texto = normalizar(texto);
    let encontrado=false;

    // Por sinÃ³nimos
    for(let nodo in sinonimos){
        for(let palabra of sinonimos[nodo]){
            if(texto.includes(palabra)){
                avanzarNodo(nodo);
                encontrado=true;
                break;
            }
        }
        if(encontrado) break;
    }

    // Por nÃºmero de opciÃ³n
    if(!encontrado){
        const opciones = chatTree[nodoActual].opciones || [];
        for(let opcion of opciones){
            if(texto === opcion.numero){
                avanzarNodo(opcion.nodo);
                encontrado=true;
                break;
            }
        }
    }

    if(!encontrado){
        mostrarMensaje("No entendÃ­ tu respuesta. SeleccionÃ¡ un botÃ³n o escribÃ­ una palabra clave.","bot");
    }
}

// Inicializar chat
mostrarMensaje(chatTree[nodoActual].mensaje);
mostrarOpciones(chatTree[nodoActual].opciones);

// Eventos
sendBtn.addEventListener("click",()=>{
    if(inputField.value.trim()!==""){
        procesarMensaje(inputField.value);
        inputField.value="";
    }
});

inputField.addEventListener("keypress",(e)=>{
    if(e.key==="Enter" && inputField.value.trim()!==""){
        procesarMensaje(inputField.value);
        inputField.value="";
    }
});

chatIcon.addEventListener("click",()=>{
    chatContainer.style.display = chatContainer.style.display==="flex"?"none":"flex";
});
</script>
</body>
</html>

